<script src="../scripts/Bootstrapper.js"></script>
<script>Bootstrapper("Focus", "dark")</script>

<div class="content">
    <div class="box">
        <div class="box-header">
            <p>Timer</p>
        </div>
        <div class="box-content">
            <center><p class="focus_timer">00:00</p></center>
            <div class="focus_buttons">
                <p onclick="focus_startButton()">Start</p>
                <p onclick="focus_pauseButton()" id="pauseButton" style="display:none;">Pause</p>
                <p onclick="focus_resumeButton()" id="resumeButton" style="display:none;">Resume</p>
                <p onclick="focus_endButton()">End</p>
            </div>
        </div>
    </div>

    <div class="dropdown-container">
        <div class="dropdown-header">
            <img src="../images/icons/dropdown_arrow_icon.png" alt="Arrow">
            <p>Setup Timer</p>
        </div>
        <div class="dropdown-content">
            <p>Focus length: <span><input class="focus_fl_input" type="number" value="10"/><br></span></p>
            <p>Break length: <span><input class="focus_bl_input" type="number" value="5"/><br></span></p>
            <p>Repeat times: <span><input class="focus_rt_input" type="number" value="3"/><br></span></p>
        </div>
    </div>
</div>

<script>
    let timer;
    let timerInterval;
    let isBreakTime = false;
    let cycleCount = 0;
    let totalCycles;

    function initializeTimer() {
        timer = 0;
        updateTimerDisplay();
    }

    function updateTimerDisplay() {
        const minutes = Math.floor(timer / 60);
        const seconds = timer % 60;
        const timeString = `${padTime(minutes)}:${padTime(seconds)}`;
        document.querySelector(".focus_timer").textContent = timeString;
    }

    function padTime(time) {
        return time < 10 ? '0' + time : time;
    }

    function startTimer() {
        timerInterval = setInterval(() => {
            if (timer > 0) {
                timer--;
                updateTimerDisplay();
            } else {
                clearInterval(timerInterval);
                alert(isBreakTime ? "Time's up! Start focus time!" : "Time's up! Take a break!");
                switchTimer();
            }
        }, 1000);
    }

    function switchTimer() {
        if (cycleCount < totalCycles) {
            isBreakTime = !isBreakTime;
            timer = isBreakTime ? breakLength : focusLength;
            updateTimerDisplay();
            setTimeout(() => {
                startTimer();
            }, 500);
            cycleCount++;
        } else {
            alert("All done, good work!");
        }
    }

    function focus_startButton() {
        const focusLength = document.querySelector('.focus_fl_input').value * 60;
        const breakLength = document.querySelector('.focus_bl_input').value * 60;
        totalCycles = document.querySelector('.focus_rt_input').value;
        cycleCount = 0;
        timer = focusLength;
        startTimer();
        document.getElementById("pauseButton").style.display = "inline-block";
        document.getElementById("resumeButton").style.display = "none";
    }

    function focus_pauseButton() {
        clearInterval(timerInterval);
        document.getElementById("pauseButton").style.display = "none";
        document.getElementById("resumeButton").style.display = "inline-block";
    }

    function focus_resumeButton() {
        startTimer();
        document.getElementById("pauseButton").style.display = "inline-block";
        document.getElementById("resumeButton").style.display = "none";
    }

    function focus_endButton() {
        clearInterval(timerInterval);
        timer = 0;
        updateTimerDisplay();
        document.getElementById("pauseButton").style.display = "none";
        document.getElementById("resumeButton").style.display = "none";
    }

    initializeTimer();
</script>

<script src="../scripts/Dropdown.js"></script>
